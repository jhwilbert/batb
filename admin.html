<!DOCTYPE html>
<html>
  <head>
		<title>Batb Admin</title>
		<link rel="stylesheet" type="text/css" href="css/main.css"/>
        <!-- Vendor -->
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.8.3.min.js"><\/script>')</script>

  </head>
  <body> 

        <div class="header-container">
            <header class="wrapper clearfix">
                <h1 class="title">Batb Admin</h1>
                <nav>
                    <ul>
                        <li><a href="#">nav ul li a</a></li>
                        <li><a href="#">nav ul li a</a></li>
                    </ul>
                </nav>
            </header>
        </div>

        <div class="main-container">
            <div class="main wrapper clearfix">

                <article>

                    <ul id="clips-list">
                    {% for video in videos %}
                        <li id="item_{{ video.key.id }}" class="clip">
                            <strong>Video ID:</strong> {{ video.key.id }}
                            <strong> Order:</strong> {{ video.order }} 
                            <strong>URL:</strong> {{ video.url }}
                        
                        <div class="removeBtn btn" id='{{ video.key.id }}'>Remove</div>
                        </li> 
                    {% endfor %}
                    </ul>

                </article>

                <aside>
                    <h3>Add Video</h3>
                    <form action="/a/addvideo" id="addForm">
                        <input type="text" name="order" value='{{ lastofplaylist }}' size="1"/>
                        <input type="text" name="url" placeholder="Video Youtube ID" />
                        <input type="submit" value="Add To Playlist" />
                    </form>
                    <div id="replyMsg">Test</div>
                </aside>

            </div> <!-- #main -->
        </div> <!-- #main-container -->
    
		<script>
		
        var youtubeURL = "https://gdata.youtube.com/feeds/api/videos/"
        var formatAPI = "?v=2&alt=json";
        
        // Remove Video
        $(".removeBtn").click(function() {
            console.log("Remove",this.id);
            var elid = this.id;
            $.post( '/a/remove', { p_id: this.id }).success(function() { 

                $("#item_"+elid).remove();
            });
        });
        
        $(".reorderBtn").click(function() {
            console.log("Reorder",this.id);
            var order = 10;
            $("")
            $.post( '/a/reorder', { p_id : this.id, p_order : order }, function(data) {});
        });
        
        // Submit Video
        $("#addForm").submit(function(event) {
            event.preventDefault(); 
            var $form = $( this );
            var videoURL = $form.find( 'input[name="url"]' ).val();
            var order = $form.find( 'input[name="order"]' ).val();
            var fullURL = youtubeURL + videoURL + formatAPI;
            
            $.get(fullURL)
              .success(function() { videoExists() })
              .error(function() { videoDoesnt() })

              function videoExists() {
                  $("#replyMsg").html("Video Exists, storing...");
                  
                  $.post( '/a/add', { p_videourl: videoURL, p_order : order }, function(data) {
                      $("#replyMsg").html("Data",data);
                  });
              }
              
              function videoDoesnt() {
                  console.debug("Video Doesn't exist")
                  $("#replyMsg").html("Video doesn't exist. Please check link...");
              }
          });

          </script>
  </body>
</html>